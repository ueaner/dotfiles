# vim: set filetype=yaml.ansible:
# https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html#understanding-variable-precedence
---

# variables

GITHUB_PROXY: "{{ lookup('env', 'GITHUB_PROXY', default='') }}"

# template for install-package module
template:
  github:
    # The <archive> key is automatically added to $vars.
    # Replace placeholders in template URL with $vars
    version: curl -s https://api.github.com/repos/<repo>/releases/latest | jq -r .tag_name # replace with $vars
    version_v: curl -s https://api.github.com/repos/<repo>/releases/latest | jq -r .tag_name | sed 's/^v//' # use with archive_v
    # https://github.com/arl/gitmux/releases/download/v0.11.2/gitmux_v0.11.2_linux_amd64.tar.gz
    archive: "{{ GITHUB_PROXY }}https://github.com/<repo>/releases/download/<version>/<archive>" # replace with $vars
    archive_v: "{{ GITHUB_PROXY }}https://github.com/<repo>/releases/download/v<version>/<archive>" # use with version_v
    # https://github.com/neovim/neovim/releases/download/nightly/nvim-linux-x86_64.tar.gz
    nightly: "{{ GITHUB_PROXY }}https://github.com/<repo>/releases/download/nightly/<archive>"
    # https://github.com/xremap/xremap/releases/latest/download/xremap-linux-x86_64-gnome.zip
    latest: "{{ GITHUB_PROXY }}https://github.com/<repo>/releases/latest/download/<archive>"
    # Requires grep (v3+) on macOS, and the Ansible target node is local
    # brew install grep
    download-url: curl -s https://api.github.com/repos/<repo>/releases/latest | grep browser_download_url | grep -P '<archive>' | sort | head -n1 | grep -P 'https://.+<archive>' -o
