---

- name: Installing Nerd Fonts for Linux
  when: ansible_system == "Linux"
  block:

    - name: Create directory -> {{ item }}
      ansible.builtin.file:
        path: ~/.local/share/fonts/{{ item }}
        state: directory
        mode: "0755"

    - name: Installing {{ item }}
      ansible.builtin.unarchive:
        src: "{{ GITHUB_PROXY }}/https://github.com/ryanoasis/nerd-fonts/releases/latest/download/SourceCodePro.tar.xz"
        dest: ~/.local/share/fonts/{{ item }}
        remote_src: true
        creates: ~/.local/share/fonts/{{ item }}/done

    - name: Update font cache
      ansible.builtin.command:
        cmd: fc-cache -f
      changed_when: false

- name: Installing Nerd Fonts for macOS
  when: ansible_system == "Darwin"
  block:

    - name: Create directory -> {{ item }}
      ansible.builtin.file:
        path: ~/Library/Fonts/{{ item }}
        state: directory
        mode: "0755"

    - name: Installing {{ item }}
      ansible.builtin.unarchive:
        src: "{{ GITHUB_PROXY }}/https://github.com/ryanoasis/nerd-fonts/releases/latest/download/SourceCodePro.tar.xz"
        dest: ~/Library/Fonts/{{ item }}
        remote_src: true
        creates: ~/Library/Fonts/{{ item }}/done


# - name: Install nerd-fonts (Linux)
#   when: ansible_system == "Linux"
#   install-package:
#     name: nerd-fonts
#     placeholders:
#       repo: ryanoasis/nerd-fonts
#     template: "{{ template.github.latest }}"
#     archives:
#       - SourceCodePro.tar.xz
#     dst: ~/.local/share/fonts/SourceCodePro
#     postinstall: |-
#       if ! ls ~/.local/share/fonts/SourceCodePro/*.ttf &>/dev/null; then
#           exit 1
#       fi
#   tags:
#     - nerd-fonts
#     - fonts
#
# - name: Install nerd-fonts (Darwin)
#   when: ansible_system == "Darwin"
#   install-package:
#     name: nerd-fonts
#     placeholders:
#       repo: ryanoasis/nerd-fonts
#     template: "{{ template.github.latest }}"
#     archives:
#       - SourceCodePro.tar.xz
#     dst: ~/Library/Fonts/SourceCodePro
#     postinstall: |-
#       if ! ls ~/Library/Fonts/SourceCodePro/*.ttf &>/dev/null; then
#           exit 1
#       fi
#   tags:
#     - nerd-fonts
#     - fonts
