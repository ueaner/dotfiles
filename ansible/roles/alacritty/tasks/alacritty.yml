# https://github.com/alacritty/alacritty/blob/master/INSTALL.md#fedora
- name: Install Alacritty Dependencies
  become: true
  become_method: sudo
  dnf:
    name:
      - cmake
      - freetype-devel
      - fontconfig-devel
      - libxcb-devel
      - libxkbcommon-devel
      - gcc-c++

- name: Install Alacritty by cargo
  shell: "~/.cargo/bin/cargo install alacritty"

- name: Install Alacritty.yml
  when: ansible_distribution == "Fedora"
  copy:
    src: files/alacritty-linux.yml
    dest: ~/.config/alacritty/alacritty.yml

- name: Install Alacritty.desktop
  shell: |
    curl --create-dirs -L {{url_prefix}}/Alacritty.desktop -o ~/.local/share/applications/Alacritty.desktop
    curl --create-dirs -L {{url_prefix}}/Alacritty.svg -o ~/.local/share/icons/Alacritty.svg
    curl --create-dirs -L {{url_prefix}}/alacritty-msg.1.gz -o ~/.local/share/man/man1/alacritty-msg.1.gz
    curl --create-dirs -L {{url_prefix}}/alacritty.1.gz -o ~/.local/share/man/man1/alacritty.1.gz
    curl --create-dirs -L {{url_prefix}}/_alacritty -o ~/.local/share/zsh/site-functions/_alacritty
  vars:
    url_prefix: https://ghproxy.com/https://github.com/alacritty/alacritty/releases/latest/download
  notify: update desktop database

# fcitx5: show preedit in Alacritty under swaywm
# https://github.com/swaywm/sway/pull/7226
- name: Detect desktop name
  shell: |
    . /etc/os-release
    if [[ "${VARIANT_ID}" == "workstation" ]]; then
      echo "gnome"
    elif [[ "${VARIANT_ID}" == "sway" ]]; then
      echo "sway"
    fi
  register: desktop_name
- debug: msg="desktop_name is {{ desktop_name.stdout }}"

- name: Install Alacritty.desktop (Sway)
  when: desktop_name.stdout == "sway"
  copy:
    src: files/Alacritty.desktop
    dest: ~/.local/share/applications/Alacritty.desktop
  notify: update desktop database
