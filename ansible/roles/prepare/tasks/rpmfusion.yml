- name: Check if rpmfusion is installed
  stat:
    path: "/etc/yum.repos.d/{{ item }}"
  with_items:
    - rpmfusion-free.repo
    - rpmfusion-nonfree.repo
  register: rpmfusion_check

#- name: Install the rpmfusion repo packages
#  when:
#  - ansible_distribution == "Fedora"
#  - not rpmfusion_check.results[0].stat.exists or not rpmfusion_check.results[1].stat.exists
#  become: true
#  become_method: sudo
#  dnf:
#    name: "{{ item }}"
#    state: present
#  with_items:
#    - http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ ansible_distribution_version }}.noarch.rpm
#    - http://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ ansible_distribution_version }}.noarch.rpm

#sudo dnf --setopt=localpkg_gpgcheck=1 install https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm -y
#sudo dnf --setopt=localpkg_gpgcheck=1 install https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm -y
- name: Install the rpmfusion repo packages
  when:
  - ansible_distribution == "Fedora"
  - not rpmfusion_check.results[0].stat.exists or not rpmfusion_check.results[1].stat.exists
  shell: |
    sudo dnf install distribution-gpg-keys -y
    sudo rpmkeys --import /usr/share/distribution-gpg-keys/rpmfusion/RPM-GPG-KEY-rpmfusion-free-fedora-$(rpm -E %fedora)
    sudo dnf install https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm -y
    sudo dnf install https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm -y
