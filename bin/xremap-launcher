#!/usr/bin/env bash
# Running Xremap without sudo on Fedora
# https://src.fedoraproject.org/rpms/fedora-release/blob/rawhide/f/fedora-release.spec

# NOTE: 查看 systemctl --user show-environment 确保 xremap 命令在输出的 PATH 中

desktop=

if [[ -n "$XDG_CURRENT_DESKTOP" ]]; then
    desktop=$(tr '[:upper:]' '[:lower:]' <<<"$XDG_CURRENT_DESKTOP")
else # ssh
    compositor_proc=$(pgrep -ax 'gnome-shell|sway')
    case "$compositor_proc" in
    *gnome-shell*)
        desktop=gnome
        ;;
    *sway*)
        desktop=sway
        ;;
    esac
fi

host_specific_config="$HOME/.config/xremap/$HOSTNAME-$desktop.yml"

if [[ -n "$desktop" && -f "$host_specific_config" ]]; then
    xremap --watch=device "$host_specific_config" ~/.config/xremap/config.yml
else
    xremap --watch=device ~/.config/xremap/config.yml
fi
